<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Configure IUB Recorder capture, AI, and export preferences"
    />
    <title>IUB Recorder ¬∑ Options</title>
    <link rel="icon" type="image/png" sizes="16x16" href="../../assets/icon16.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="../../assets/icon48.png" />
    <link rel="icon" type="image/png" sizes="128x128" href="../../assets/icon128.png" />
    <link rel="stylesheet" href="options.css" />
    <script src="shared.js"></script>
  </head>
  <body>
    <header class="title-wrapper" role="banner">
      <div class="brand">
        <img src="../../assets/icon128.png" alt="IUB logo" />
        <div class="brand-copy">
          <h1>IUB Recorder</h1>
          <p class="title-lead">
            <span id="version" aria-live="polite"></span>
          </p>
          <p class="tagline">Tune capture, AI, and export preferences from one place.</p>
        </div>
      </div>
      <div class="header-actions">
        <button id="open-sidebar" class="action-button">üìÇ Open sidebar</button>
        <button id="open-workspace" class="action-button">üè¢ Open workspace</button>
        <button id="open-editor" class="action-button">‚úèÔ∏è Open editor</button>
      </div>
    </header>

    <main>
      <section class="intro-callout" aria-label="Quick start guide">
        <h2>Quick start</h2>
        <ol>
          <li>Add your OpenAI API key so the assistant can describe each step.</li>
          <li>Choose how we capture the screen when you click.</li>
          <li>Open the advanced sections only when you need export or cloud options.</li>
        </ol>
      </section>

      <section class="card-grid" aria-label="Status overview">
        <article class="status-card storage-card">
          <h3>üíæ Storage usage</h3>
          <div id="storage-info">
            <div><strong>Used:</strong> <span id="storage-used">Loading‚Ä¶</span></div>
            <div><strong>Free:</strong> <span id="storage-free">Loading‚Ä¶</span></div>
            <div class="storage-bar">
              <div id="storage-bar"></div>
            </div>
            <div id="cloud-status-row" class="cloud-status">
              <span>‚òÅÔ∏è Sync status:</span>
              <span id="cloud-status-text" data-state="local">Local only</span>
            </div>
            <small id="cloud-status-hint">
              Configure cloud sync below to avoid hitting the Chrome storage quota.
            </small>
            <button id="delete-all-sessions-btn" class="ghost-button">
              üóëÔ∏è Delete all sessions
            </button>
          </div>
        </article>

        <article id="ai-status-card" class="status-card ai-card">
          <h3>ü§ñ AI features</h3>
          <div id="ai-status">
            <div><strong>Status:</strong> <span id="ai-status-text">Checking‚Ä¶</span></div>
            <p class="card-hint">
              Add your OpenAI API key below to unlock automatic screenshot descriptions.
            </p>
          </div>
        </article>

        <article class="status-card click-card">
          <h3>üéØ Click indicator</h3>
          <p class="card-hint">Show a red ripple where you clicked on each capture.</p>
          <label class="checkbox-row">
            <input type="checkbox" id="show-click-indicator-option" />
            <span>Enable click indicator</span>
          </label>
        </article>
      </section>

      <form
        class="options"
        aria-labelledby="options-title"
        autocomplete="off"
        spellcheck="false"
      >
        <h2 id="options-title">Options</h2>

        <section class="settings-group">
          <h3 class="settings-heading" id="sidepanel-group-title">Side panel basics</h3>
          <div class="form-row">
            <label for="api_key">OpenAI API key</label>
            <div class="input-stack">
              <input
                type="password"
                name="api_key"
                id="api_key"
                placeholder="sk-proj-..."
                aria-describedby="api-key-status api-key-hint"
              />
              <div class="status-inline" id="api-key-status" data-state="missing">
                Missing ‚Äì enter your key to enable AI features.
              </div>
              <small id="api-key-hint">
                Required for AI-powered side panel captions. Get your key from
                <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">
                  OpenAI
                </a>.
              </small>
            </div>
          </div>

          <div class="form-row">
            <label for="capture_mode">Capture mode</label>
            <select name="capture_mode" id="capture_mode">
              <option value="full">Full screen</option>
              <option value="click">Area around click</option>
            </select>
            <small>Click mode keeps files smaller by focusing on what you interact with.</small>
          </div>
        </section>

        <details class="settings-group" open>
          <summary class="settings-heading" id="export-group-title">AI chat PDF export (advanced)</summary>
          <div class="details-content">
            <div class="form-row">
              <label for="theme">Color theme</label>
              <select name="theme" id="theme">
                <option value="">Auto</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>

            <label class="checkbox-row">
              <input type="checkbox" name="no_questions" id="no_questions" />
              <span>Exclude user input bubbles</span>
            </label>
            <label class="checkbox-row">
              <input type="checkbox" name="no_icons" id="no_icons" />
              <span>Hide reaction icons</span>
            </label>

            <div class="form-row">
              <label for="zoom">Font size (30‚Äì300%)</label>
              <input type="number" name="zoom" id="zoom" min="30" max="300" step="5" />
            </div>

            <div class="form-row">
              <label for="margins">Page margins</label>
              <select name="margins" id="margins">
                <option value="">Default</option>
                <option value="minimal">Minimal</option>
                <option value="custom">Custom</option>
              </select>
            </div>

            <div class="form-row sub-row sub-margin" id="custom-margins">
              <div class="sub-grid">
                <label for="margin_top">Top margin (mm)</label>
                <input type="number" name="margin_top" id="margin_top" min="0" />
                <label for="margin_bottom">Bottom margin (mm)</label>
                <input type="number" name="margin_bottom" id="margin_bottom" min="0" />
                <label for="margin_left">Left margin (mm)</label>
                <input type="number" name="margin_left" id="margin_left" min="0" />
                <label for="margin_right">Right margin (mm)</label>
                <input type="number" name="margin_right" id="margin_right" min="0" />
              </div>
            </div>

            <div class="form-row">
              <label for="title_mode">PDF title</label>
              <select name="title_mode" id="title_mode">
                <option value="">Use capture title</option>
                <option value="ask">Ask me</option>
                <option value="none">No title</option>
              </select>
            </div>

            <div class="form-row">
              <label for="q_color">User input background color</label>
              <select name="q_color" id="q_color">
                <option value="default">Default</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="custom">Custom</option>
              </select>
            </div>

            <div class="form-row" id="q_color_picker_row">
              <label for="q_color_picker">Choose background color</label>
              <input type="color" name="q_color_picker" id="q_color_picker" />
            </div>

            <div class="form-row">
              <label for="q_fg_color">User input text color</label>
              <select name="q_fg_color" id="q_fg_color">
                <option value="default">Default</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="custom">Custom</option>
              </select>
            </div>

            <div class="form-row" id="q_fg_color_picker_row">
              <label for="q_fg_color_picker">Choose text color</label>
              <input type="color" name="q_fg_color_picker" id="q_fg_color_picker" />
            </div>

            <div class="form-row">
              <label for="page_break">Page breaks</label>
              <select name="page_break" id="page_break">
                <option value="">Auto</option>
                <option value="after_each">After each capture</option>
              </select>
            </div>

            <div class="form-row">
              <label for="toc">Table of contents</label>
              <select name="toc" id="toc">
                <option value="">None</option>
                <option value="basic">Standard</option>
                <option value="numbered">Numbered</option>
              </select>
              <small class="toc-note">The table of contents is built from your capture titles.</small>
            </div>

            <label class="checkbox-row">
              <input type="checkbox" name="model_name" id="model_name" />
              <span>Include AI model name in the export</span>
            </label>
          </div>
        </details>

        <details class="settings-group">
          <summary class="settings-heading" id="cloud-group-title">Cloud sync (optional)</summary>
          <div class="details-content">
            <div class="form-row">
              <label for="storage_provider">Sync provider</label>
              <select name="storage_provider" id="storage_provider">
                <option value="local">Local only</option>
                <option value="dropbox">Dropbox</option>
                <option value="onedrive">OneDrive</option>
                <option value="gdrive">Google Drive</option>
              </select>
            </div>

            <div class="form-row">
              <label for="cloud_file_name">Session file name</label>
              <input
                type="text"
                name="cloud_file_name"
                id="cloud_file_name"
                placeholder="iub-recorder-sessions.json"
              />
              <small>Stored as JSON ‚Äì keep the .json extension.</small>
            </div>

            <div class="form-row cloud-field" data-provider="dropbox">
              <label for="dropbox_token">Dropbox access token</label>
              <input type="password" name="dropbox_token" id="dropbox_token" />
            </div>
            <div class="form-row cloud-field" data-provider="dropbox">
              <label for="dropbox_path">Dropbox folder path</label>
              <input type="text" name="dropbox_path" id="dropbox_path" />
            </div>

            <div class="form-row cloud-field" data-provider="onedrive">
              <label for="onedrive_token">OneDrive access token</label>
              <input type="password" name="onedrive_token" id="onedrive_token" />
            </div>
            <div class="form-row cloud-field" data-provider="onedrive">
              <label for="onedrive_path">OneDrive folder path</label>
              <input type="text" name="onedrive_path" id="onedrive_path" />
            </div>

            <div class="form-row cloud-field" data-provider="gdrive">
              <label for="gdrive_token">Google Drive token</label>
              <input type="password" name="gdrive_token" id="gdrive_token" />
            </div>
            <div class="form-row cloud-field" data-provider="gdrive">
              <label for="gdrive_folder_id">Google Drive folder ID</label>
              <input type="text" name="gdrive_folder_id" id="gdrive_folder_id" />
            </div>
            <div class="form-row cloud-field" data-provider="gdrive">
              <label for="gdrive_file_id">Google Drive file ID</label>
              <input type="text" name="gdrive_file_id" id="gdrive_file_id" />
            </div>
          </div>
        </details>

        <div class="form-actions">
          <button type="submit" id="save" class="save">Apply changes</button>
          <button type="button" id="reset" class="secondary">Reset</button>
          <span id="status" role="status" aria-live="polite"></span>
        </div>
      </form>
    </main>

    <script src="options.js" type="module"></script>
    <script type="module" src="options-i18n.js"></script>
  </body>
</html>
